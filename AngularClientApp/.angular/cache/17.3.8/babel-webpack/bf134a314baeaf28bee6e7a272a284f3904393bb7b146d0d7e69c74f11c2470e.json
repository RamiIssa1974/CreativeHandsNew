{"ast":null,"code":"import { DatePipe } from '@angular/common';\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { CustomValidator } from '../../../Model/Validators/CustomValidators';\nimport { AuthService } from '../../../services/auth.service';\nimport { PurchaseService } from '../../../services/purchase.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"../../../services/purchase.service\";\nimport * as i4 from \"@angular/forms\";\nimport * as i5 from \"../../../services/auth.service\";\nconst _c0 = a0 => ({\n  \"is-invalid\": a0\n});\nfunction AddEditPurchaseComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 32);\n    i0.ɵɵelement(1, \"img\", 33);\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AddEditPurchaseComponent_div_14_option_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 38);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const provider_r2 = ctx.$implicit;\n    i0.ɵɵpropertyInterpolate(\"value\", provider_r2.Id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(provider_r2.Name);\n  }\n}\nfunction AddEditPurchaseComponent_div_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 34)(1, \"select\", 35);\n    i0.ɵɵtemplate(2, AddEditPurchaseComponent_div_14_option_2_Template, 2, 2, \"option\", 36);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(3, \"i\", 37);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.providersList);\n  }\n}\nexport let AddEditPurchaseComponent = /*#__PURE__*/(() => {\n  class AddEditPurchaseComponent {\n    get isLoggedIn() {\n      return this.authService.isLoggedIn;\n    }\n    get isAdmin() {\n      return this.authService.isAdmin;\n    }\n    get fileUploader() {\n      //console.log(JSON.stringify(this.productForm.controls['file_uploaders']));\n      return this.purchaseForm.controls['file_uploader'].value;\n    }\n    get purchasesImage() {\n      return this.purchaseForm.get('Image');\n    }\n    get purchasesId() {\n      const val = this.purchaseForm.get('Id');\n      return val ? val.value ?? -1 : -1;\n    }\n    get purchasesProviderId() {\n      return this.purchaseForm.get('ProviderId');\n    }\n    get purchasesAmount() {\n      return this.purchaseForm.get('Amount');\n    }\n    get purchasesDate() {\n      return this.purchaseForm.get('CreateDate');\n    }\n    get purchasesDescription() {\n      const val = this.purchaseForm.get('Description');\n      return val ? val.value ?? '' : '';\n    }\n    get purchasesPurchaseLink() {\n      return this.purchaseForm.get('PurchaseLink');\n    }\n    constructor(datePipe, route, purchaseServices, fb, authService, router) {\n      this.datePipe = datePipe;\n      this.route = route;\n      this.purchaseServices = purchaseServices;\n      this.fb = fb;\n      this.authService = authService;\n      this.router = router;\n      this.newFiles = [];\n      this.deletedFiles = [];\n      this.isLoading = false;\n      this.purchaseId = -1;\n      this.selectedfileName = \"please select a file\";\n      this.errorMessage = 'OK';\n      this.purchaseForm = new FormGroup({});\n      this.providersList = [];\n    }\n    ngOnInit() {\n      if (!(this.isLoggedIn && this.isAdmin)) {\n        this.router.navigateByUrl(this.authService.redirectUrl || '/default-url');\n      }\n      this.purchaseServices.getProviders().subscribe(providers => {\n        this.providersList = providers;\n      });\n      this.purchaseForm = this.getEmptyForm();\n      this.route.params.subscribe(params => {\n        this.purchaseId = params['id'];\n        if (this.purchaseId != null) {\n          this.purchaseServices.getPurchaseById(this.purchaseId).subscribe({\n            next: purchase => {\n              this.purchaseId = purchase.Id;\n              this.purchase = purchase;\n              this.purchaseForm = this.getFormFromPurchase(this.purchase);\n            },\n            error: err => this.errorMessage = err\n          });\n        } else {\n          this.purchaseForm = this.getEmptyForm();\n        }\n      });\n    }\n    onSelectFile(files) {\n      //console.log(\"url\" + JSON.stringify(files[0]));\n      this.selectedfileName = files[0].name;\n      this.fileToUpload = files[0];\n      this.purchaseForm.controls['Image'].setValue(files[0].name);\n      this.purchaseForm.controls['Image'].updateValueAndValidity();\n      this.purchaseForm.updateValueAndValidity();\n    }\n    deleteFile(filename, index) {\n      this.purchaseForm.controls['Image'].setValue(\"\");\n      //this.fileToUpload.slice(index, 1);\n      this.purchaseForm.controls['Image'].updateValueAndValidity();\n      this.purchaseForm.updateValueAndValidity();\n    }\n    getEmptyForm() {\n      return this.fb.group({\n        Id: [{\n          value: 0,\n          disabled: true\n        }],\n        ProviderId: [\"\", [Validators.required]],\n        Amount: [\"\", [Validators.required, Validators.min(0.01), CustomValidator.numeric]],\n        CreateDate: [\"\", [Validators.required]],\n        Description: \"\",\n        PurchaseLink: \"\",\n        Image: [\"\", [Validators.required]]\n      });\n    }\n    getFormFromPurchase(purchse) {\n      var formGroup = this.fb.group({\n        Id: [{\n          value: purchse.Id,\n          disabled: true\n        }],\n        ProviderId: [purchse.ProviderId, [Validators.required]],\n        Amount: [purchse.Amount, [Validators.required, Validators.min(0.01), CustomValidator.numeric]],\n        CreateDate: [purchse.CreateDate, [Validators.required]],\n        Description: purchse.Description,\n        PurchaseLink: purchse.PurchaseLink,\n        Image: [purchse.Image, [Validators.required]]\n      });\n      return formGroup;\n    }\n    savePurchase() {\n      this.isLoading = true;\n      let request = {\n        Id: this.purchasesId,\n        ProviderId: this.purchasesProviderId.value,\n        Description: this.purchasesDescription,\n        Amount: this.purchasesAmount.value,\n        CreateDate: this.purchasesDate.value,\n        PurchaseLink: this.purchasesPurchaseLink.value,\n        Image: this.purchasesImage == null ? \"\" : this.purchasesImage.value,\n        Provider: null\n      };\n      this.purchaseServices.savePurchase(request).subscribe(purchaseId => {\n        if (purchaseId > 0) {\n          if (this.fileToUpload) {\n            this.purchaseServices.uploadFile(this.fileToUpload, purchaseId).subscribe(saveRes => {\n              this.isLoading = false;\n              this.router.navigateByUrl('/purchase/' + purchaseId);\n            });\n          } else {\n            this.isLoading = false;\n          }\n        }\n      });\n    }\n    static #_ = this.ɵfac = function AddEditPurchaseComponent_Factory(t) {\n      return new (t || AddEditPurchaseComponent)(i0.ɵɵdirectiveInject(i1.DatePipe), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i3.PurchaseService), i0.ɵɵdirectiveInject(i4.FormBuilder), i0.ɵɵdirectiveInject(i5.AuthService), i0.ɵɵdirectiveInject(i2.Router));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: AddEditPurchaseComponent,\n      selectors: [[\"app-add-edit-purchase\"]],\n      features: [i0.ɵɵProvidersFeature([DatePipe])],\n      decls: 47,\n      vars: 17,\n      consts: [[\"fileUploader\", \"\"], [\"novalidate\", \"\", 3, \"ngSubmit\", \"formGroup\"], [\"class\", \"overlay\", 4, \"ngIf\"], [1, \"card-body\"], [1, \"purchase-info\"], [1, \"form-group\", \"row\", \"title\"], [1, \"title\"], [1, \"form-group\", \"row\"], [\"for\", \"idId\", 1, \"data-label\"], [\"id\", \"idId\", \"formControlName\", \"Id\", 1, \"form-control\", \"purchase-id\", 3, \"disabled\"], [\"for\", \"providerIdId\", 1, \"data-label\"], [\"class\", \"dropdown-select\", 4, \"ngIf\"], [\"for\", \"amountId\", 1, \"data-label\"], [\"id\", \"amountId\", \"formControlName\", \"Amount\", 1, \"purchase-amount\", \"form-control\", 3, \"ngClass\"], [\"for\", \"CreateDateId\", 1, \"data-label\"], [\"id\", \"CreateDateId\", \"formControlName\", \"CreateDate\", 1, \"purchase-date\", \"form-control\", 3, \"ngClass\"], [\"for\", \"PurchaseLinkId\", 1, \"data-label\"], [\"id\", \"PurchaseLinkId\", \"formControlName\", \"PurchaseLink\", 1, \"purchase-purchase-link\", \"form-control\", 3, \"ngClass\"], [\"for\", \"descriptionId\", 1, \"data-label\"], [\"id\", \"descriptionId\", \"formControlName\", \"Description\", 1, \"purchase-Description\", \"form-control\"], [1, \"form-group\", \"row\", \"purchase-image\"], [1, \"form-group\", \"selected-purchase-image\"], [1, \"purchase-image-thumb\"], [3, \"src\"], [1, \"purchase-image-name\"], [1, \"form-group\", \"uploader\"], [\"for\", \"fileUploader\", 1, \"btn\", \"btn-primary\", \"mr-3\"], [\"src\", \"/assets/Images/AddFile.png\"], [\"id\", \"selectedFileId\", \"name\", \"selectedFileId\", \"type\", \"text\", 1, \"form-control\", \"file-input\", 3, \"value\"], [\"type\", \"file\", \"id\", \"fileUploader\", \"multiple\", \"\", \"accept\", \"image/*\", 2, \"display\", \"none\", 3, \"change\"], [1, \"submit-div\"], [\"type\", \"submit\", \"title\", \"\\u062D\\u0641\\u0638\", 1, \"btn\", \"btn-primary\", \"mr-3\"], [1, \"overlay\"], [\"src\", \"/assets/Images/loading.gif\", 1, \"waiting-image\"], [1, \"dropdown-select\"], [\"id\", \"providerIdId\", \"formControlName\", \"ProviderId\", 1, \"provider-id\"], [\"class\", \"dropdown-item\", 3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"aria-hidden\", \"true\", 1, \"fa\", \"fa-filter\"], [1, \"dropdown-item\", 3, \"value\"]],\n      template: function AddEditPurchaseComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          const _r1 = i0.ɵɵgetCurrentView();\n          i0.ɵɵelementStart(0, \"form\", 1);\n          i0.ɵɵlistener(\"ngSubmit\", function AddEditPurchaseComponent_Template_form_ngSubmit_0_listener() {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.savePurchase());\n          });\n          i0.ɵɵtemplate(1, AddEditPurchaseComponent_div_1_Template, 2, 0, \"div\", 2);\n          i0.ɵɵelementStart(2, \"div\", 3)(3, \"div\", 4)(4, \"div\", 5)(5, \"span\", 6);\n          i0.ɵɵtext(6, \"\\u0641\\u0627\\u062A\\u0648\\u0631\\u0629 \\u0634\\u0631\\u0627\\u0621\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(7, \"div\", 7)(8, \"label\", 8);\n          i0.ɵɵtext(9, \"\\u0627\\u0644\\u0645\\u0639\\u0631\\u0641:\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(10, \"input\", 9);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(11, \"div\", 7)(12, \"label\", 10);\n          i0.ɵɵtext(13, \"\\u0627\\u0644\\u0645\\u0632\\u0648\\u062F:\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(14, AddEditPurchaseComponent_div_14_Template, 4, 1, \"div\", 11);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(15, \"div\", 7)(16, \"label\", 12);\n          i0.ɵɵtext(17, \"\\u0627\\u0644\\u0645\\u0628\\u0644\\u063A:\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(18, \"input\", 13);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(19, \"div\", 7)(20, \"label\", 14);\n          i0.ɵɵtext(21, \"\\u062A\\u0627\\u0631\\u064A\\u062E \\u0627\\u0644\\u0634\\u0631\\u0627\\u0621:\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(22, \"input\", 15);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(23, \"div\", 7)(24, \"label\", 16);\n          i0.ɵɵtext(25, \"\\u0631\\u0627\\u0628\\u0637 \\u0627\\u0644\\u0641\\u0627\\u062A\\u0648\\u0631\\u0647:\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(26, \"input\", 17);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(27, \"div\", 7)(28, \"label\", 18);\n          i0.ɵɵtext(29, \"\\u0627\\u0644\\u0648\\u0635\\u0641:\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(30, \"textarea\", 19);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(31, \"div\", 20)(32, \"div\", 21)(33, \"div\", 22);\n          i0.ɵɵelement(34, \"img\", 23);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(35, \"div\", 24);\n          i0.ɵɵtext(36);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(37, \"div\", 25)(38, \"label\", 26);\n          i0.ɵɵelement(39, \"img\", 27);\n          i0.ɵɵtext(40, \"\\u0627\\u062E\\u062A\\u0631 \\u0635\\u0648\\u0631\\u0647\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(41, \"input\", 28);\n          i0.ɵɵelementStart(42, \"input\", 29, 0);\n          i0.ɵɵlistener(\"change\", function AddEditPurchaseComponent_Template_input_change_42_listener() {\n            i0.ɵɵrestoreView(_r1);\n            const fileUploader_r4 = i0.ɵɵreference(43);\n            return i0.ɵɵresetView(ctx.onSelectFile(fileUploader_r4.files));\n          });\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(44, \"div\", 30)(45, \"button\", 31);\n          i0.ɵɵtext(46, \"\\u062D\\u0641\\u0638\");\n          i0.ɵɵelementEnd()()()()();\n        }\n        if (rf & 2) {\n          i0.ɵɵproperty(\"formGroup\", ctx.purchaseForm);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.isLoading);\n          i0.ɵɵadvance(9);\n          i0.ɵɵproperty(\"disabled\", true);\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"ngIf\", ctx.providersList);\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(11, _c0, (ctx.purchasesAmount.touched || ctx.purchasesAmount.dirty) && !ctx.purchasesAmount.valid));\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(13, _c0, (ctx.purchasesDate.touched || ctx.purchasesDate.dirty) && !ctx.purchasesDate.valid));\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(15, _c0, (ctx.purchasesPurchaseLink.touched || ctx.purchasesPurchaseLink.dirty) && !ctx.purchasesPurchaseLink.valid));\n          i0.ɵɵadvance(8);\n          i0.ɵɵpropertyInterpolate1(\"src\", \"/assets/Images/\", (ctx.purchasesImage == null ? null : ctx.purchasesImage.value) || \"No image available\", \"\", i0.ɵɵsanitizeUrl);\n          i0.ɵɵadvance(2);\n          i0.ɵɵtextInterpolate((ctx.purchasesImage == null ? null : ctx.purchasesImage.value) || \"No image available\");\n          i0.ɵɵadvance(5);\n          i0.ɵɵpropertyInterpolate(\"value\", ctx.purchasesImage.value);\n        }\n      },\n      dependencies: [i1.NgClass, i1.NgForOf, i1.NgIf, i4.ɵNgNoValidate, i4.NgSelectOption, i4.ɵNgSelectMultipleOption, i4.DefaultValueAccessor, i4.SelectControlValueAccessor, i4.NgControlStatus, i4.NgControlStatusGroup, i4.FormGroupDirective, i4.FormControlName],\n      styles: [\".overlay[_ngcontent-%COMP%]{background:#e9e9e9;position:absolute;inset:0;opacity:.5;z-index:1}.waiting-image[_ngcontent-%COMP%]{position:absolute;top:50%;left:45%}.card-body[_ngcontent-%COMP%]{position:relative;border:10px solid aliceblue;background-color:#ddd8c1;width:100%;text-align:center}.form-group.row[_ngcontent-%COMP%]{text-align:right}.submit-div[_ngcontent-%COMP%]{margin:20px 0;text-align:center}.submit-div[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:80%;margin:0!important}.uploader[_ngcontent-%COMP%]{width:100%}.uploader[_ngcontent-%COMP%]   .file-input[_ngcontent-%COMP%]{display:inline;width:70%;margin-right:13px}.uploader[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{float:right;margin:0!important;padding:4px!important}.uploader[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:20px;background-color:transparent;margin-left:5px;height:20px}.data-label[_ngcontent-%COMP%]{margin-right:20px;font-weight:700;text-align:right;width:15%}.purchase-info[_ngcontent-%COMP%]{padding:7px;border:1px solid orange;border-radius:10px;width:500px;display:inline-block;margin:10px;background-color:#f0f8ff}.purchase-info[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .purchase-info[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .purchase-info[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{width:70%}.form-group.row[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{width:100%;margin:auto;text-align:center;font-weight:700;font-size:x-large;color:brown}.dropdown-select[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{position:absolute;left:12px;top:12px;font-size:20px}.status-id-label[_ngcontent-%COMP%]{margin-left:10px;font-weight:700;display:flex}.dropdown-select[_ngcontent-%COMP%]{display:inline-block;position:relative;font-family:Arial;margin-left:10px}.dropdown-select[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{height:40px;min-width:361px;border-radius:5px;border-color:#ced4da;padding-right:15px}.purchase-image[_ngcontent-%COMP%]{display:inline-block;border:1px solid gray;padding:5px;text-align:right;width:83%}.selected-purchase-image[_ngcontent-%COMP%]{display:inline-block;border:1px solid gray;padding:5px;text-align:right;width:100%}.purchase-image-thumb[_ngcontent-%COMP%]{margin-right:10px;display:inline-block}.purchase-image-thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:5px;border:1px solid green;width:40px!important;height:40px!important}.purchase-image-name[_ngcontent-%COMP%]{margin-right:5%;width:65%;display:inline-block}.purchase-image-icon[_ngcontent-%COMP%]{width:15%;display:inline-block;text-align:left}.purchase-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:180px;width:210px}.purchase-image[_ngcontent-%COMP%]   .delete-icon[_ngcontent-%COMP%]{cursor:pointer;float:left;margin:5px 5px 0 10px;width:20px;height:20px;background-color:transparent}.purchase-amount[_ngcontent-%COMP%]{color:#2e8b57;display:inline-block;width:30%}.purchase-id[_ngcontent-%COMP%]{font-weight:700}@media only screen and (max-width: 600px){.purchase-info[_ngcontent-%COMP%]{padding:7px;border:1px solid orange;border-radius:10px;width:95%;display:inline-block;margin:10px;background-color:#f0f8ff}.purchase-info[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .purchase-info[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:85%;margin-right:20px;margin-bottom:5px}.dropdown-select[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{height:40px;min-width:100px;width:280px;border-radius:5px;border-color:#ced4da;padding-right:15px;margin-right:20px}.data-label[_ngcontent-%COMP%]{margin-right:20px;font-weight:700;text-align:right;width:80%}.purchase-image-name[_ngcontent-%COMP%]{margin-right:5%;width:48%;display:inline-block}.card-body[_ngcontent-%COMP%]{padding:0;border:none}.uploader[_ngcontent-%COMP%]   .file-input[_ngcontent-%COMP%]{display:inline;width:98%!important;margin:10px 0 0!important}.submit-div[_ngcontent-%COMP%]{margin:20px 0;text-align:center}.submit-div[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:80%;margin:0!important}}\"]\n    });\n  }\n  return AddEditPurchaseComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}